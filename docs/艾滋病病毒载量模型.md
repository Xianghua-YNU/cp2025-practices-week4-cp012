# 导入必要的库
import numpy as np  # 用于数值计算和数组操作，比如生成数组和计算指数函数
import matplotlib.pyplot as plt  # 用于绘图，生成曲线和散点图

# 导入实验数据
# 使用 np.loadtxt 从 CSV 文件中加载数据，假定文件名为 'HIVseries.csv'
# delimiter=',' 指定数据以逗号分隔，文件中每行包含时间和病毒载量
hiv_data = np.loadtxt('HIVseries.csv', delimiter=',')
# 将数据分为两列：时间（天）和病毒载量
time_data = hiv_data[:, 0]  # 第一列（索引0）：自治疗开始以来的天数
viral_data = hiv_data[:, 1]  # 第二列（索引1）：血液中HIV病毒的浓度（任意单位）

# 设置模型参数
# A, B 是控制初始病毒浓度的参数，alpha, beta 是控制衰减速度的参数
A = 1000  # 第一个衰减项的初始浓度，表示模型中较慢衰减部分的起始值
B = 200   # 第二个衰减项的初始浓度，表示模型中较快衰减部分的起始值
alpha = 0.05  # 第一个衰减项的衰减率，控制较慢的指数衰减速度
beta = 0.5    # 第二个衰减项的衰减率，控制较快的指数衰减速度

# 生成模型的时间点
# 使用 np.linspace 生成从实验数据的最小时间到最大时间之间的100个均匀分布的时间点
# 这将用于绘制平滑的模型曲线，而不是离散的实验数据点
time_model = np.linspace(min(time_data), max(time_data), 100)

# 计算模型的病毒载量 V(t)
# 使用公式 V(t) = A * exp(-alpha * t) + B * exp(-beta * t)
# 这个公式模拟HIV病毒载量随时间的双指数衰减
# np.exp 是 NumPy 的指数函数，用于计算 e 的幂
viral_model = A * np.exp(-alpha * time_model) + B * np.exp(-beta * time_model)

# 绘制模型曲线和实验数据点
# 使用 plt.plot 绘制模型曲线，label 参数用于在图例中显示参数值
plt.plot(time_model, viral_model, label=f'A={A}, alpha={alpha}, B={B}, beta={beta}')
# 使用 plt.scatter 绘制实验数据点，marker='o' 表示圆形标记，color='red' 设置为红色
plt.scatter(time_data, viral_data, marker='o', color='red', label='实验数据')
# 设置 x 轴和 y 轴的标签，清晰说明坐标轴含义
plt.xlabel('时间 (天)')
plt.ylabel('病毒载量')
# 设置图表标题，概括内容
plt.title('HIV病毒载量模型与实验数据')
# 显示图例，说明曲线和数据点的含义
plt.legend()
# 显示网格线，帮助观察数据点与曲线的相对位置
plt.grid(True)
# 显示图表，将所有绘图元素渲染到屏幕上
plt.show()

# 计算并打印 1/alpha
# 1/alpha 表示第一个衰减项的时间常数（单位为天），反映较慢衰减的时间尺度
print(f"1/alpha = {1/alpha} 天")
